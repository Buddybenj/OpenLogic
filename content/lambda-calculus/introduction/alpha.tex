% Part: lambda-calculus
% Chapter: introduction
% Section: alpha

\documentclass[../../../include/open-logic-section]{subfiles}

\begin{document}

\olfileid{lc}{int}{alp}
\olsection{$\alpha$-conversion}

What's the relation between $\lambd[x][x]$ and $\lambd[y][y]$? They
both seem to be the identity function. Here is the $\alpha$-conversion:

\begin{defn}[Change of bound variable, $\aconvone$]
  If a term $M$ contains an occurrences of $\lambd[x][N]$, $y \notin
  FV(N)$, and $N[y/x]$ is defined, then replacing this occurrences
  by 
  \begin{equation*}
    \lambd[y][N[y/x]]
  \end{equation*}
  resulting in $M'$ is called a \emph{change of bound variable}, written
  as $M \redone[\alpha] M'$.
\end{defn}


We used the word ``occurrence'' in above definition, which is not very
standard but captures the idea. It is mostly known as
\emph{compatibility}. 
\begin{defn}[Compatibility of relation]
  A relation $R$ on terms is said to be \emph{compatible}
  if it satisfies following conditions:
  \begin{enumerate}
  \item If $R N N'$ then $R \lambd[x][N] \lambd[x][N']$
  \item If $R P P'$ then $R (PQ) (P'Q)$
  \item If $R Q Q'$ then $R (PQ) (PQ')$
  \end{enumerate}
\end{defn}

Thus let's rephrase the definition:
\begin{defn}[Change of bound variable, $\aconvone$]
  \emph{Change of bound variable} ($\redone[\alpha]$) is 
  the smalllest compatible relation on terms satisfying following
  condition:
  \begin{align*}
    &\lambd[x][N] \redone[\alpha] \lambd[y][\Subst{N}{y}{x}] \text{if
      $x \neq y$, $y \notin FV(N)$} \\
    & &&\text{and $\Subst{N}{y}{x}$ is defined}
  \end{align*}
\end{defn}

``smallest'' means the relation contains only pairs that's required by
the compatibility and the additional condition, and nothing else. Thus
this relation can also be defined as follows:
\begin{defn}[Change of bound variable, $\aconvone$] \ollabel{def}
  \emph{Change of bound variable} ($\aconvone$) is inductively
  defined as follows:
  \begin{enumerate}
  \item If $N \aconvone N'$ then $\lambd[x][N] \aconvone
    \lambd[x][N']$ \ollabel{def:1}
  \item If $P \aconvone P'$ then $(PQ) \aconvone (P'Q)$ \ollabel{def:2}
  \item If $Q \aconvone Q'$ then $(PQ) \aconvone (PQ')$ \ollabel{def:3}
  \item if $x \neq y$, $y \notin FV(N)$ and $\Subst{N}{y}{x}$ is defined, then
    $\lambd[x][N] \redone[\alpha] \lambd[y][\Subst{N}{y}{x}]$.
    \ollabel{def:4}
    
  \end{enumerate}
\end{defn}

The proof of the equivalence of the two definition is left to
interested readers, but from now on we will use the later one as our
definition.

\begin{defn}[$\alpha$-conversion, $\aconv$]
  \emph{$\alpha$-conversion} ($\aconv$) is the smallest reflexitive, transitive relation on terms containing $\aconvone$.
\end{defn}

As above, ``smallest'' means the relation only contains pairs required
by the transitivity, and $\aconvone$, which leads to the following equivalent definition:
\begin{defn}[$\alpha$-conversion, $\aconv$]
  \emph{$\alpha$-conversion} ($\aconv$) is inductively defined as follows:
  \begin{enumerate}
  \item If $P \aconv Q$ and $Q \aconv R$, then $P \aconv R$.
    \ollabel{aconv:1}
  \item If $P \aconvone Q$, then $P \aconv Q$. \ollabel{aconv:2}
  \item $P \aconv P$. \ollabel{aconv:3}
  \end{enumerate}
\end{defn}

\begin{ex}
  $\lambd[x][f x]$ $\alpha$-converts to $\lambd[y][f
  y]$, and the other way around too. Informally
  speaking, they are both functions that accpets an argument and
  return $f$ of that argument, refering to the environment variable $f$.
\end{ex}
\begin{ex}
  $\lambd[x][f x]$ cannot $\alpha$-converts $\lambd[x][g
  x]$. Informally speaking, they refers to the environment variables $f$ and $g$ respectively,
  making them different functions: they behave differently in
  environment where $f$ and $g$ is different.
\end{ex}

\begin{prob}
  Tell if the following pairs of terms are $\alpha$-convertable.
  \begin{enumerate}
  \item $\lambd[x][\lambd[y][x]]$ and $\lambd[y][\lambd[x][y]]$
  \item $\lambd[x][\lambd[y][x]]$ and $\lambd[c][\lambd[b][a]]$
  \item $\lambd[x][\lambd[y][x]]$ and $\lambd[c][\lambd[b][a]]$
  \end{enumerate}
\end{prob}

\begin{lem}\ollabel{lem:fv-one}
  If $P \aconvone Q$ then $FV(P) = FV(Q)$.
\end{lem}
\begin{proof}
  Induction on the derivation of $P \aconvone Q$.
  \begin{enumerate}
  \item If the last rule is \olref{def:4}, then $P$ is of the form
    $\lambd[x][N]$ and $Q$ of the form
    $\lambd[y][\Subst{N}{y}{x}]$, with $x \neq y$, $y \notin
    FV(N)$ and $\Subst{N}{y}{x}$ defined. Depending on whether
    $x \in FV(N)$:
    \begin{enumerate}
    \item $x \in FV(N)$, then:
      \begin{align*}
        &FV(\lambd[y][\Subst{N}{y}{x}])\\
        =&FV(\Subst{N}{y}{x}) \setminus \{y\} \\
        =&((FV(N) \setminus \{x\}) \cup \{y\}) \setminus \{y\}
         && \text{ by \olref[sub]{thm:infv}} \\
        =&FV(N) \setminus \{x\} \\
        =&FV(\lambd[x][N])
      \end{align*}
    \item $x \notin FV(N)$ then:
      \begin{align*}
        &FV(\lambd[y][\Subst{N}{y}{x}])\\
        =&FV(\Subst{N}{y}{x}) \setminus \{y\} \\
        =&FV(N) \setminus \{x\}
         && \text{by \olref[sub]{thm:notinfv}} \\
        =&FV(\lambd[x][N])
      \end{align*}
    \end{enumerate}
  \item The other three cases are left as exercises. \ollabel{lem:fv-one:2}.
  \end{enumerate}
\end{proof}

\begin{prob}
  Finish \olref{lem:fv-one:2}.
\end{prob}

\begin{lem}\ollabel{lem:inv}
  If $P \aconvone Q$ then $Q \aconvone P$.
\end{lem}
\begin{proof}
  Induction on the derivation of $P \redone{\alpha} Q$.
  \begin{enumerate}
  \item Last rule is \olref{def:4}, then $P$ is of the form
    $\lambd[x][N]$ and $Q$ of the form
    $\lambd[y][\Subst{N}{y}{x}]$, where $x \neq y$, $y \notin FV(N)$ and
    $\Subst{N}{y}{x}$ defined. Firstly we have $y \notin
    FV(\Subst{N}{y}{x})$ by \olref[sub]{thm:clr}; Also 
    by \olref[sub]{thm:inv} we have
    $\Subst{\Subst{N}{y}{x}}{x}{y}$ is not only defined, but
    also equal to $N$. Then by \olref{def:4} we have
    $\lambd[y][\Subst{N}{y}{x}] \aconvone
    \lambd[x][\Subst{\Subst{N}{y}{x}}{x}{y}] = \lambd[x][N]$.
  \item The other three cases are left as exercises. \ollabel{lem:inv:2}
  \end{enumerate}
\end{proof}

\begin{prob}
  Prove \olref{lem:inv:2}.
\end{prob}

\begin{thm}
  $\alpha$-conversion is an equivalence relation (\olref[sfr][rel][prp]{sec}) on terms.
\end{thm}
\begin{proof}
  \begin{enumerate}
  \item[reflexive] For each term $M$, $M$ can be changed to $M$ by
    \emph{zero} steps of change of bound variables.
  \item[symmetric] If $P$ is changed to $Q$ by a series of change
    of bound variables, then from $Q$ we can just inverse these
    changes (by \olref{lem:inv}) in
    opposite order and we should get $P$.
  \item[transitive] If $P$ is changed to $Q$ by a series of
    change, and $Q$ to $R$ by another series, then we can change
    $P$ to $R$ by first applying the first series and then the
    second series.
  \end{enumerate}
\end{proof}

From now on we write $M \aeq N$ if $M$ is $\alpha$-equivalent to
$N$, although there is no difference between $\alpha$-equivalence and
$\alpha$-conversion.

\begin{thm}\ollabel{thm:fv}
  If $M \aeq N$, then $FV(M) = FV(N)$.
\end{thm}
\begin{proof}
  Immediate from \olref{lem:fv-one}.
\end{proof}

\begin{lem}\ollabel{lem:sub:R}
  If $R \aeq R'$ and $\Subst{M}{R}{y}$ is defined, then $\Subst{M}{R'}{y}$ is
  defined and $\alpha$-equivalent to $\Subst{M}{R}{y}$.
\end{lem}
\begin{proof}
  Left as exercise.
\end{proof}

\begin{prob}
  Prove \olref{lem:sub:R}.
\end{prob}

Recall that in \olref[sub]{sec} substitution is
undefined in some cases; however, by some
$\alpha$-conversion on terms, we can make the substitution defined,
and the results preserve the $\alpha$-equivalence, as shown in this theorem:
\begin{thm}\ollabel{thm:sub}
  For any $M$, for any $R, y$, there exists $M'$
  such that $M \aeq M'$ and $\Subst{M'}{R}{y}$ is defined; moreover, if there's another pair of
  $M''$ and $R''$ satisfying such condition and $R'' \aeq R$, then $\Subst{M'}{R}{y} \aeq \Subst{M''}{R''}{y}$.
\end{thm}
\begin{proof}
  By induction on the formation of $M$:
  \begin{enumerate}
  \item $M$ is of the form $\lambd[x][N]$, then we:
    \begin{enumerate}
    \item Select $z$ such that $z \notin FV(xyNR)$.
    \item By inductive hypothesis, we can have $N'$ such that $N' \aeq N$
      and $\Subst{N'}{z}{x}$ is defined. Then $\lambd[x][N] \aeq
      \lambd[x][N']$ too, by \olref{def:1}.
    \item Now $\lambd[x][N'] \aeq \lambd[z][\Subst{N'}{z}{x}]$ by \olref{def:4}.
      we can do this becuase $z \ne x$, $z \notin FV(N')$ and
      $\Subst{N'}{z}{x}$ is defined.
    \item Finally we can see that
      $\Subst{\lambd[z][\Subst{N'}{z}{x}]}{R}{y}$ is defined,
      because $z \neq y$ and $z \notin FV(R)$.
    \item Moreover, if there's another $N''$ and $R''$ satisfying such
      property, then:
      \begin{align*}
        &\Subst{(\lambd[z][\Subst{N''}{z}{x}])}{R''}{y}\\
        =&\lambd[z][\Subst{\Subst{N''}{z}{x}}{R''}{y}] \\
        =&\lambd[z][\Subst{\Subst{N''}{z}{x}}{R}{y}]
         && \text{by \olref{lem:sub:R}}\\
        =&\lambd[z][\Subst{\Subst{N'}{z}{x}}{R}{y}]
         && \text{by inductive hypothesis}\\
        =&\Subst{(\lambd[z][\Subst{N'}{z}{x}])}{R}{y}
      \end{align*}
    \end{enumerate}
  \item The other two cases are left as
    exercises. \ollabel{thm:sub:2}
  \end{enumerate}
\end{proof}

\begin{prob}
  Prove \olref{thm:sub:2}.
\end{prob}

\begin{cor}\ollabel{cor:sub}
  For any $M$, for any $R, y$, there exists a pair of $M'$ and $R'$
  such that $M \aeq M'$, $R \aeq R'$ and $\Subst{M'}{R'}{y}$ is defined; moreover,
  if there's another pair of
  $M''$ and $R''$ satisfying such condition, then $\Subst{M'}{R'}{y} \aeq \Subst{M''}{R''}{y}$.
\end{cor}
\begin{proof}
  Immediate from \olref{thm:sub}.
\end{proof}

\end{document}

