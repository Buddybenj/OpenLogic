% Part: lambda-calculus
% Chapter: church-rosser
% Section: parallel-reduction

\documentclass[../../../include/open-logic-section]{subfiles}

\begin{document}

\olfileid{lc}{cr}{par}

\olsection{Parallel Reduction}

In this section we introduce \emph{parallel reduction}, and prove it
satisfying CR.

\begin{defn}[parallel reduction, $\redpar$]
  Parallel reduction ($\redpar$) of terms is inductively defined as follows:
  \begin{enumerate}
    \item \ollabel{def:1} $x \redpar x$.
    \item \ollabel{def:2} If $N \redpar N'$ then $\lambd[x][N] \redpar
      \lambd[x][N']$.
    \item \ollabel{def:3} If $P \redpar P'$ and $Q \redpar Q'$ then $PQ \redpar
      P'Q'$.
    \item \ollabel{def:4} If $N \redpar N'$ and $Q \redpar Q'$ then
      $(\lambd[x][N])Q \redpar \Subst{N'}{Q'}{x}$.
  \end{enumerate}
\end{defn}

\begin{thm}\ollabel{thm:refl}
  $M \redpar M$.
\end{thm}
\begin{proof}
  Left as exercise.
\end{proof}

\begin{defn}[complete development]\ollabel{cd}
  The \emph{complete development} of $M$, or $\cd{M}$, is defined
  as follows:
  \begin{align}
    \cd{x} &= x \ollabel{cd:1} \\
    \cd{\lambd[x][N]} &= \lambd[x][\cd{N}] \ollabel{cd:2}\\
    \cd{PQ} &= \cd{P}\cd{Q} && \text{if $P$ is not abstraction} \ollabel{cd:3} \\
    \cd{(\lambd[x][N])Q} &= \Subst{\cd{N}}{\cd{Q}}{x} \ollabel{cd:4}
  \end{align}
\end{defn}

\begin{editorial}
  This definition has the problem that we haven't introduced how to
  define functions on terms recursively. Will fix in future.
\end{editorial}

\begin{lem}\ollabel{lem:comp}
  If $M \redpar M'$ and $R \redpar R'$, then $\Subst{M}{P}{y}
  \redpar \Subst{M'}{P'}{y}$.
\end{lem}
\begin{proof}
  By induction on the derivation of $M \redpar M'$.
  \begin{enumerate}
    \item If the last step is \olref{def:1}, left as exercise.
    \item If the last step is \olref{def:2}, then $M$ is 
      $\lambd[x][N]$ and $M'$ is $\lambd[x][N']$,
      where $N \redpar N'$. What we want to prove is
      $\Subst{(\lambd[x][N])}{R}{y} \redpar
      \Subst{(\lambd[x][N'])}{R'}{y}$, which is
      $\lambd[x][\Subst{N}{R}{y}] \redpar
      \lambd[x][\Subst{N'}{R}{y}]$, which is immediate by
      \olref{def:2} and I.H.
    \item If the last step is \olref{def:3}, left as exercise.
    \item If the last step is \olref{def:4}, then $M$ is
      $(\lambd[x][N])Q$ and $M'$ is $\Subst{N'}{Q'}{x}$. What
      we want to prove is $\Subst{((\lambd[x][N])Q)}{R}{y}
      \redpar \Subst{\Subst{N'}{Q'}{x}}{R'}{y}$, which is
      $(\lambd[x][\Subst{N}{R}{y}])\Subst{Q}{R}{y} \redpar
      \Subst{\Subst{N'}{R'}{y}}{\Subst{Q'}{R'}{y}}{x}$, which
      can be derived by \olref{def:4} with I.H.
  \end{enumerate}
\end{proof}

\begin{lem}\ollabel{lem:cont}
  If $M \redpar M'$ then $M' \redpar \cd{M}$.
\end{lem}
\begin{proof}
  By induction on the derivation of $M \redpar M'$.
  \begin{enumerate}
    \item If the last rule is \olref{def:1}, left as exercise.
    \item If the last rule is \olref{def:2} then $M$ is 
      $\lambd[x][N]$ and $M'$ is $\lambd[x][N']$ with
      $N \redpar N'$. We want $\lambd[x][N'] \redpar
      \cd{(\lambd[x][N])}$, which is $\lambd[x][N'] \redpar
      \lambd[x][\cd{N}]$ by \olref{cd:2}, which is immediate by
      \olref{def:2} and I.H.. 
    \item If the last rule is \olref{def:3} then $M$ is 
      $PQ$ and $M'$ is $P'Q'$ for some $P$, $Q$, $P'$ and $Q'$, with $P \redpar P'$
      and $Q \redpar Q'$. By I.H. we have $P' \redpar \cd{P}$ and
      $Q' \redpar \cd{Q}$.  Depending on whether $P$ is 
      $\lambd[x][N]$ for some $x$ and $N$:
      \begin{enumerate}
        \item $P$ is not, then $P'Q' \redpar \cd{P}\cd{Q}$ by
          \olref{def:3}, and the right-hand is $\cd{PQ}$ by \olref{cd:3}.
        \item $P$ is $\lambd[x][N]$ for some $x$ and $N$, then
          $P'$ must be $\lambd[x][N']$ for some $N'$ with 
          $N \redpar N'$. By I.H. we have $N' \redpar \cd{N}$ and
          $Q' \redpar \cd{Q}$, then $(\lambd[x][N'])Q' \redpar
          \Subst{\cd{N}}{\cd{Q}}{x}$ by \olref{def:4} which is what
          we want.
      \end{enumerate}
    \item If the last rule is \olref{def:4} then $M$ is 
      $(\lambd[x][N])Q$  and $M'$ is $\Subst{N'}{Q'}{x}$
      for some $x, N, Q, N', Q'$, with $N \redpar N'$ and $Q
      \redpar Q'$. By I.H. we know $N' \redpar \cd{N}$ and $Q'
      \redpar \cd{Q}$, further by \olref{lem:comp} we have
      $\Subst{N'}{Q'}{x} \redpar \Subst{\cd{N}}{\cd{Q}}{x}$, the
      right hand of which is exactly $\cd{((\lambd[x][N])Q)}$.
  \end{enumerate}
\end{proof}

\begin{thm}\ollabel{thm:cr}
  $\redpar$ has Church-Rosser property.
\end{thm}
\begin{proof}
  Immediate from \olref{lem:cont}.
\end{proof}

\end{document}

